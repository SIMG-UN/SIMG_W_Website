name: Create Event

on:
  workflow_dispatch:
    inputs:
      title_en:
        description: "Event title (English)"
        required: true
        type: string
      title_es:
        description: "Event title (Spanish)"
        required: true
        type: string
      description_en:
        description: "Short description (English)"
        required: false
        type: string
      description_es:
        description: "Short description (Spanish)"
        required: false
        type: string
      date:
        description: "Event date (YYYY-MM-DD)"
        required: true
        type: string
      time:
        description: "Time range (e.g., 2:00 PM - 4:00 PM)"
        required: false
        default: "2:00 PM - 4:00 PM"
        type: string
      speaker:
        description: "Speaker name"
        required: false
        default: "SIMG Research Group"
        type: string
      event_type:
        description: "Event type"
        required: true
        type: choice
        options:
          - in-person
          - virtual
          - hybrid
      duration:
        description: "Duration (e.g., 1h 30m)"
        required: false
        default: "1h 30m"
        type: string
      tags:
        description: "Tags (comma separated)"
        required: false
        default: "AI,Research"
        type: string

jobs:
  create-event:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      - name: Install dependencies
        run: bun install

      - name: Create event files
        run: |
          node scripts/create-event.mjs --non-interactive \
            --title "${{ inputs.title_en }}" \
            --title-es "${{ inputs.title_es }}" \
            --desc "${{ inputs.description_en }}" \
            --desc-es "${{ inputs.description_es }}" \
            --date "${{ inputs.date }}" \
            --time "${{ inputs.time }}" \
            --speaker "${{ inputs.speaker }}" \
            --type "${{ inputs.event_type }}" \
            --duration "${{ inputs.duration }}" \
            --tags "${{ inputs.tags }}"

      - name: Generate thumbnail
        run: node scripts/generate-thumbnail.mjs --title "${{ inputs.title_en }}" --date "${{ inputs.date }}" --type "${{ inputs.event_type }}"
        env:
          BANANA_API_KEY: ${{ secrets.BANANA_API_KEY }}
          BANANA_MODEL_KEY: ${{ secrets.BANANA_MODEL_KEY }}

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "feat: add event - ${{ inputs.title_en }}"
          title: "New Event: ${{ inputs.title_en }}"
          body: |
            ## New Event Created via GitHub Actions

            - **Title (EN):** ${{ inputs.title_en }}
            - **Title (ES):** ${{ inputs.title_es }}
            - **Date:** ${{ inputs.date }}
            - **Time:** ${{ inputs.time }}
            - **Type:** ${{ inputs.event_type }}
            - **Speaker:** ${{ inputs.speaker }}
            - **Tags:** ${{ inputs.tags }}

            ---
            *Auto-generated by the Create Event workflow.*
          branch: event/${{ inputs.date }}-new
          labels: events, auto-generated
